# SEO Implementation

This document describes the SEO setup for Cosmic Index, a Next.js 15 space encyclopedia with 5,000+ exoplanets and 1,000,000+ small bodies.

## Overview

The SEO implementation follows industry best practices for Next.js applications:

- **Server-Side Rendering** for detail pages (critical for search engine indexing)
- **Dynamic Metadata** with `generateMetadata()` for unique titles/descriptions per page
- **JSON-LD Structured Data** for rich search results
- **XML Sitemaps** for search engine discovery
- **robots.txt** for crawler directives

## Architecture

```
src/app/
├── layout.tsx              # Root metadata, JSON-LD WebSite schema
├── robots.ts               # robots.txt generation
├── sitemap.ts              # Static sitemap (main pages)
├── sitemap-exoplanets/
│   └── route.ts            # Dynamic sitemap for all exoplanets
├── sitemap-small-bodies/
│   └── route.ts            # Dynamic sitemap for PHAs
├── exoplanets/
│   ├── layout.tsx          # List page metadata
│   └── [id]/
│       ├── page.tsx        # SSR with generateMetadata, JSON-LD
│       └── not-found.tsx   # Custom 404
└── small-bodies/
    ├── layout.tsx          # List page metadata
    └── [id]/
        ├── page.tsx        # SSR with generateMetadata, JSON-LD
        └── not-found.tsx   # Custom 404

src/lib/
└── sitemap.ts              # Sitemap XML generation utilities

src/components/
└── breadcrumbs.tsx         # Breadcrumbs with JSON-LD BreadcrumbList
```

## Metadata

### Root Layout (`src/app/layout.tsx`)

The root layout defines base metadata inherited by all pages:

```typescript
export const metadata: Metadata = {
  metadataBase: new URL("https://cosmic-index.vercel.app"),
  title: {
    default: "Cosmic Index - Explore Exoplanets & Small Bodies",
    template: "%s | Cosmic Index",  // Child pages use this template
  },
  description: "...",
  openGraph: { ... },
  twitter: { ... },
  robots: { ... },
};
```

### Detail Pages

Detail pages use `generateMetadata()` for dynamic, per-object metadata:

```typescript
export async function generateMetadata({ params }): Promise<Metadata> {
  const data = await fetchExoplanetBySlug(id);
  return {
    title: data.displayName,  // Uses template: "Kepler-22b | Cosmic Index"
    description: data.summary.slice(0, 155),
    openGraph: { ... },
    twitter: { ... },
    alternates: { canonical: `${BASE_URL}/exoplanets/${id}` },
  };
}
```

### List Pages

List pages use layout files to define static metadata since the page components are client components:

- `src/app/exoplanets/layout.tsx`
- `src/app/small-bodies/layout.tsx`

## Structured Data (JSON-LD)

### WebSite Schema (Root Layout)

Defines the site with search actions:

```json
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Cosmic Index",
  "url": "https://cosmic-index.vercel.app",
  "potentialAction": [
    {
      "@type": "SearchAction",
      "target": ".../exoplanets?query={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  ]
}
```

### BreadcrumbList Schema (Detail Pages)

Generated by `src/components/breadcrumbs.tsx`:

```json
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Home", "item": "..." },
    { "@type": "ListItem", "position": 2, "name": "Exoplanets", "item": "..." },
    { "@type": "ListItem", "position": 3, "name": "Kepler-22b" }
  ]
}
```

### Astronomical Object Schema (Detail Pages)

Each object has structured data with properties:

```json
{
  "@context": "https://schema.org",
  "@type": "Thing",
  "name": "Kepler-22b",
  "description": "...",
  "url": "...",
  "additionalProperty": [
    { "@type": "PropertyValue", "name": "Host Star", "value": "Kepler-22" },
    { "@type": "PropertyValue", "name": "Radius", "value": "2.38", "unitText": "Earth radii" }
  ],
  "sameAs": ["https://exoplanetarchive.ipac.caltech.edu/overview/Kepler-22b"]
}
```

## Sitemaps

### Static Sitemap (`/sitemap.xml`)

Contains the main pages:
- `/` (homepage)
- `/exoplanets` (list page)
- `/small-bodies` (list page)

### Dynamic Sitemaps

| Route | Content | Update Frequency |
|-------|---------|------------------|
| `/sitemap-exoplanets` | All ~5,000 exoplanets | Daily (cached 24h) |
| `/sitemap-small-bodies` | PHAs (Potentially Hazardous Asteroids) | Daily (cached 24h) |

The small bodies sitemap focuses on PHAs rather than all 1M+ objects for practical reasons.

### Sitemap Utilities (`src/lib/sitemap.ts`)

Helper functions for generating sitemap XML:

```typescript
import { generateSitemapXml, buildUrl, getIsoDate } from "@/lib/sitemap";

const urls = [
  { loc: buildUrl("/exoplanets/kepler-22b"), lastmod: getIsoDate(), priority: 0.6 }
];
const xml = generateSitemapXml(urls);
```

## robots.txt

Generated by `src/app/robots.ts`:

```
User-agent: *
Allow: /
Disallow: /api/

Sitemap: https://cosmic-index.vercel.app/sitemap.xml
Sitemap: https://cosmic-index.vercel.app/sitemap-exoplanets
Sitemap: https://cosmic-index.vercel.app/sitemap-small-bodies
```

## Server-Side Rendering

Detail pages are server components that:

1. Fetch data directly using lib functions (not client-side fetch)
2. Render content on the server
3. Return HTML with content visible to search engines

Before (client component):
```typescript
"use client";
export default function Page() {
  const [data, setData] = useState(null);
  useEffect(() => { fetch(...) }, []);  // Content not in initial HTML
}
```

After (server component):
```typescript
export default async function Page({ params }) {
  const data = await fetchExoplanetBySlug(id);  // Content in initial HTML
  return <ObjectDetail object={data} />;
}
```

## Verification

### Local Testing

1. **Build check**: `bun run build` - Ensure no errors
2. **View source**: Open detail page, view source, confirm content is in HTML
3. **robots.txt**: Visit `/robots.txt`
4. **Sitemaps**: Visit `/sitemap.xml`, `/sitemap-exoplanets`, `/sitemap-small-bodies`

### DevTools Inspection

1. Open browser DevTools
2. Elements tab > `<head>` section
3. Check for:
   - `<title>` tag with object name
   - `<meta name="description">` with summary
   - `<meta property="og:*">` tags
   - `<script type="application/ld+json">` with structured data

### External Tools

- [Google Rich Results Test](https://search.google.com/test/rich-results) - Validate JSON-LD
- [Google Search Console](https://search.google.com/search-console) - Monitor indexing
- [Schema.org Validator](https://validator.schema.org/) - Test structured data

## OpenGraph Image

The metadata references `/og-image.png` (1200x630) for social sharing. This image should be created and placed in `public/og-image.png`.

## Search Console Setup

After deployment:

1. Add property in Google Search Console
2. Submit sitemaps:
   - `https://cosmic-index.vercel.app/sitemap.xml`
   - `https://cosmic-index.vercel.app/sitemap-exoplanets`
   - `https://cosmic-index.vercel.app/sitemap-small-bodies`
3. Monitor Coverage report for indexing issues

## Configuration

The base URL is defined in multiple files:

```typescript
const BASE_URL = "https://cosmic-index.vercel.app";
```

If the domain changes, update:
- `src/app/layout.tsx`
- `src/app/robots.ts`
- `src/app/sitemap.ts`
- `src/app/sitemap-exoplanets/route.ts`
- `src/app/sitemap-small-bodies/route.ts`
- `src/app/exoplanets/[id]/page.tsx`
- `src/app/small-bodies/[id]/page.tsx`
- `src/app/exoplanets/layout.tsx`
- `src/app/small-bodies/layout.tsx`
- `src/lib/sitemap.ts`
- `src/components/breadcrumbs.tsx`

Consider centralizing this in a config file for easier updates.
